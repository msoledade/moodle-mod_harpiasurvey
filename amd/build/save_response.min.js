define("mod_harpiasurvey/save_response",["exports","core/notification","core/str","core/config","jquery"],(function(_exports,_notification,_str,_config,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Save response module for harpiasurvey.
   *
   * @module     mod_harpiasurvey/save_response
   * @copyright  2025 Your Name
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=_interopRequireDefault(_notification),_config=_interopRequireDefault(_config),_jquery=_interopRequireDefault(_jquery);let initialized=!1;_exports.init=(cmid,pageid)=>{initialized||((0,_jquery.default)("select[data-saved-value]").each((function(){const select=(0,_jquery.default)(this),savedValue=select.data("saved-value");savedValue&&select.val(savedValue)})),(0,_jquery.default)(document).on("click",".save-response-btn",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),questionid=parseInt(button.data("questionid"),10),questiontype=button.data("questiontype");let response="";if("singlechoice"===questiontype||"likert"===questiontype){const selected=(0,_jquery.default)('input[name="question_'.concat(questionid,'"]:checked'));selected.length>0&&(response=selected.val())}else if("multiplechoice"===questiontype){const selected=(0,_jquery.default)('input[name="question_'.concat(questionid,'[]"]:checked')),values=[];selected.each((function(){values.push((0,_jquery.default)(this).val())})),response=JSON.stringify(values)}else if("select"===questiontype){const selected=(0,_jquery.default)("#question_".concat(questionid)).val();selected&&(response=selected)}else("number"===questiontype||"shorttext"===questiontype||"longtext"===questiontype)&&(response=(0,_jquery.default)("#question_".concat(questionid)).val());saveResponse(cmid,pageid,questionid,response,button)})),initialized=!0)};const saveResponse=(cmid,pageid,questionid,response,button)=>{const originalText=button.text();button.prop("disabled",!0),(0,_str.get_string)("saving","mod_harpiasurvey").then((savingText=>{button.text(savingText);const params=new URLSearchParams({action:"save_response",cmid:cmid,pageid:pageid,questionid:questionid,response:response,sesskey:_config.default.sesskey});fetch(_config.default.wwwroot+"/mod/harpiasurvey/ajax.php?"+params.toString(),{method:"GET",headers:{"Content-Type":"application/json"}}).then((response=>response.json())).then((data=>{data.success?(0,_str.get_string)("saved","mod_harpiasurvey").then((savedText=>{button.text(savedText),button.removeClass("btn-primary").addClass("btn-success");const savedMessage=(0,_jquery.default)('.saved-response-message[data-questionid="'.concat(questionid,'"]'));if(0===savedMessage.length){const datetimeStr=(new Date).toLocaleString();(0,_str.get_string)("on","mod_harpiasurvey").then((onText=>{const messageHtml='<div class="mt-1 small text-muted saved-response-message" '+'data-questionid="'.concat(questionid,'">')+'<i class="fa fa-check-circle" aria-hidden="true"></i> '+"".concat(savedText," ").concat(onText," ").concat(datetimeStr,"</div>");button.after(messageHtml)}))}else{const datetimeStr=(new Date).toLocaleString();(0,_str.get_string)("on","mod_harpiasurvey").then((onText=>{savedMessage.html("".concat('<i class="fa fa-check-circle" aria-hidden="true"></i>'," ").concat(savedText," ").concat(onText," ").concat(datetimeStr))}))}setTimeout((()=>{button.prop("disabled",!1),button.text(originalText),button.removeClass("btn-success").addClass("btn-primary")}),2e3)})):(_notification.default.addNotification({message:data.message||"Error saving response",type:"error"}),button.prop("disabled",!1),button.text(originalText))})).catch((error=>{_notification.default.addNotification({message:"Error saving response: "+error.message,type:"error"}),button.prop("disabled",!1),button.text(originalText)}))}))}}));

//# sourceMappingURL=save_response.min.js.map