{"version":3,"file":"sortable_table.min.js","sources":["../src/sortable_table.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Sortable table functionality for experiments table.\n *\n * @module     mod_harpiasurvey/sortable_table\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n    'use strict';\n\n    /**\n     * Initialize sortable table functionality.\n     *\n     * @param {string} tableSelector CSS selector for the table (optional, defaults to all sortable tables)\n     */\n    function init(tableSelector) {\n        // If no selector provided, find all sortable tables.\n        const selector = tableSelector || '.harpiasurvey-sortable-table[data-sortable=\"true\"], .harpiasurvey-sortable-table';\n        const tables = $(selector);\n\n        if (!tables.length) {\n            return;\n        }\n\n        // Initialize each table.\n        tables.each(function() {\n            initTable($(this));\n        });\n    }\n\n    /**\n     * Initialize a single table.\n     *\n     * @param {jQuery} table The table element\n     */\n    function initTable(table) {\n\n        if (table.data('sortable-initialized')) {\n            return; // Already initialized.\n        }\n        table.data('sortable-initialized', true);\n\n        const headers = table.find('thead th');\n\n        // Make headers clickable and add cursor style.\n        headers.each(function(index) {\n            const header = $(this);\n            // Skip the actions column (last column).\n            if (index === headers.length - 1) {\n                return;\n            }\n\n            header.css('cursor', 'pointer');\n            header.attr('role', 'button');\n            header.attr('tabindex', '0');\n            const headerText = header.text().trim().replace(/ [↑↓↕]$/, '');\n            header.attr('aria-label', headerText + ' - Click to sort');\n\n            // Add click handler.\n            header.on('click', function() {\n                sortTable(table, index, header);\n            });\n\n            // Add keyboard support.\n            header.on('keypress', function(e) {\n                if (e.which === 13 || e.which === 32) { // Enter or Space\n                    e.preventDefault();\n                    sortTable(table, index, header);\n                }\n            });\n        });\n    }\n\n    /**\n     * Sort the table by the specified column.\n     *\n     * @param {jQuery} table The table element\n     * @param {number} columnIndex The column index to sort by\n     * @param {jQuery} header The header element that was clicked\n     */\n    function sortTable(table, columnIndex, header) {\n        const tbody = table.find('tbody');\n        const rows = tbody.find('tr').toArray();\n        const headers = table.find('thead th');\n\n        // Determine current sort direction.\n        let sortDirection = 'asc';\n        const currentSort = header.data('sort-direction');\n        if (currentSort === 'asc') {\n            sortDirection = 'desc';\n        }\n\n        // Remove sort indicators from all headers.\n        headers.each(function() {\n            const h = $(this);\n            h.removeClass('sort-asc sort-desc');\n            h.data('sort-direction', null);\n            // Remove arrows from text.\n            let text = h.html();\n            text = text.replace(/ [↑↓↕]$/, '');\n            h.html(text);\n        });\n\n        // Add sort indicator to current header.\n        header.addClass('sort-' + sortDirection);\n        header.data('sort-direction', sortDirection);\n        let headerText = header.html().replace(/ [↑↓↕]$/, '');\n        const arrow = sortDirection === 'asc' ? ' ↑' : ' ↓';\n        header.html(headerText + arrow);\n\n        // Sort rows.\n        rows.sort(function(a, b) {\n            const aCell = $(a).find('td').eq(columnIndex);\n            const bCell = $(b).find('td').eq(columnIndex);\n\n            // Get text content, handling links.\n            let aText = aCell.text().trim();\n            let bText = bCell.text().trim();\n\n            // Check if it's a numeric column (participants, max participants).\n            const isNumeric = columnIndex === 1 || columnIndex === 2;\n\n            if (isNumeric) {\n                // Handle \"unlimited\" or other text values.\n                const aNum = parseFloat(aText) || 0;\n                const bNum = parseFloat(bText) || 0;\n                if (aNum === bNum) {\n                    return 0;\n                }\n                return sortDirection === 'asc' ? (aNum - bNum) : (bNum - aNum);\n            } else {\n                // Text sorting.\n                aText = aText.toLowerCase();\n                bText = bText.toLowerCase();\n                if (aText === bText) {\n                    return 0;\n                }\n                if (sortDirection === 'asc') {\n                    return aText < bText ? -1 : 1;\n                } else {\n                    return aText > bText ? -1 : 1;\n                }\n            }\n        });\n\n        // Re-append sorted rows.\n        tbody.empty();\n        rows.forEach(function(row) {\n            tbody.append(row);\n        });\n    }\n\n    return {\n        init: init\n    };\n});\n\n"],"names":["define","$","sortTable","table","columnIndex","header","tbody","find","rows","toArray","headers","sortDirection","data","each","h","this","removeClass","text","html","replace","addClass","headerText","arrow","sort","a","b","aCell","eq","bCell","aText","trim","bText","aNum","parseFloat","bNum","toLowerCase","empty","forEach","row","append","init","tableSelector","tables","length","index","css","attr","on","e","which","preventDefault","initTable"],"mappings":";;;;;;;AAuBAA,yCAAO,CAAC,WAAW,SAASC,YAyEfC,UAAUC,MAAOC,YAAaC,cAC7BC,MAAQH,MAAMI,KAAK,SACnBC,KAAOF,MAAMC,KAAK,MAAME,UACxBC,QAAUP,MAAMI,KAAK,gBAGvBI,cAAgB,MAEA,QADAN,OAAOO,KAAK,oBAE5BD,cAAgB,QAIpBD,QAAQG,MAAK,iBACHC,EAAIb,EAAEc,MACZD,EAAEE,YAAY,sBACdF,EAAEF,KAAK,iBAAkB,UAErBK,KAAOH,EAAEI,OACbD,KAAOA,KAAKE,QAAQ,UAAW,IAC/BL,EAAEI,KAAKD,SAIXZ,OAAOe,SAAS,QAAUT,eAC1BN,OAAOO,KAAK,iBAAkBD,mBAC1BU,WAAahB,OAAOa,OAAOC,QAAQ,UAAW,UAC5CG,MAA0B,QAAlBX,cAA0B,KAAO,KAC/CN,OAAOa,KAAKG,WAAaC,OAGzBd,KAAKe,MAAK,SAASC,EAAGC,SACZC,MAAQzB,EAAEuB,GAAGjB,KAAK,MAAMoB,GAAGvB,aAC3BwB,MAAQ3B,EAAEwB,GAAGlB,KAAK,MAAMoB,GAAGvB,iBAG7ByB,MAAQH,MAAMT,OAAOa,OACrBC,MAAQH,MAAMX,OAAOa,UAGS,IAAhB1B,aAAqC,IAAhBA,YAExB,OAEL4B,KAAOC,WAAWJ,QAAU,EAC5BK,KAAOD,WAAWF,QAAU,SAC9BC,OAASE,KACF,EAEc,QAAlBvB,cAA2BqB,KAAOE,KAASA,KAAOF,YAGzDH,MAAQA,MAAMM,cACdJ,MAAQA,MAAMI,cACVN,QAAUE,MACH,EAEW,QAAlBpB,cACOkB,MAAQE,OAAS,EAAI,EAErBF,MAAQE,OAAS,EAAI,KAMxCzB,MAAM8B,QACN5B,KAAK6B,SAAQ,SAASC,KAClBhC,MAAMiC,OAAOD,cAId,CACHE,cA1IUC,qBAGJC,OAASzC,EADEwC,eAAiB,oFAG7BC,OAAOC,QAKZD,OAAO7B,MAAK,qBAUGV,UAEXA,MAAMS,KAAK,+BAGfT,MAAMS,KAAK,wBAAwB,SAE7BF,QAAUP,MAAMI,KAAK,YAG3BG,QAAQG,MAAK,SAAS+B,aACZvC,OAASJ,EAAEc,SAEb6B,QAAUlC,QAAQiC,OAAS,SAI/BtC,OAAOwC,IAAI,SAAU,WACrBxC,OAAOyC,KAAK,OAAQ,UACpBzC,OAAOyC,KAAK,WAAY,WAClBzB,WAAahB,OAAOY,OAAOa,OAAOX,QAAQ,UAAW,IAC3Dd,OAAOyC,KAAK,aAAczB,WAAa,oBAGvChB,OAAO0C,GAAG,SAAS,WACf7C,UAAUC,MAAOyC,MAAOvC,WAI5BA,OAAO0C,GAAG,YAAY,SAASC,GACX,KAAZA,EAAEC,OAA4B,KAAZD,EAAEC,QACpBD,EAAEE,iBACFhD,UAAUC,MAAOyC,MAAOvC,eAzChC8C,CAAUlD,EAAEc"}