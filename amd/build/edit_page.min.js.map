{"version":3,"file":"edit_page.min.js","sources":["../src/edit_page.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Edit page module.\n *\n * @module     mod_harpiasurvey/edit_page\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Notification from 'core/notification';\nimport Config from 'core/config';\nimport $ from 'jquery';\n\n/**\n * Initialize the edit page functionality.\n */\nexport const init = () => {\n    // Handle evaluates conversation dropdown changes.\n    $(\"body\").on(\"change\", \".evaluates-conversation-select\", function() {\n        const select = $(this);\n        const pagequestionid = select.data('pagequestionid');\n        const cmid = select.data('cmid');\n        const evaluatesConversationId = parseInt(select.val(), 10) || 0;\n\n        // Disable the select while updating.\n        select.prop('disabled', true);\n\n        const wwwroot = Config.wwwroot;\n        const sesskey = Config.sesskey || M.cfg.sesskey;\n        const ajaxUrl = wwwroot + '/mod/harpiasurvey/ajax.php';\n        const params = new URLSearchParams({\n            action: 'update_evaluates_conversation',\n            cmid: cmid,\n            pagequestionid: pagequestionid,\n            evaluates_conversation_id: evaluatesConversationId,\n            sesskey: sesskey\n        });\n\n        fetch(ajaxUrl + '?' + params.toString())\n            .then((response) => response.json())\n            .then((response) => {\n                select.prop('disabled', false);\n                if (response.success) {\n                    Notification.addNotification({\n                        message: response.message || 'Conversation relationship updated',\n                        type: 'success'\n                    });\n                } else {\n                    // Revert the selection on error.\n                    select.val(select.data('previous-value') || 0);\n                    Notification.addNotification({\n                        message: response.message || 'Error updating conversation relationship',\n                        type: 'error'\n                    });\n                }\n            })\n            .catch((error) => {\n                select.prop('disabled', false);\n                // Revert the selection on error.\n                select.val(select.data('previous-value') || 0);\n                Notification.exception(error);\n            });\n    });\n\n    // Store previous value on focus for potential revert.\n    $(\"body\").on(\"focus\", \".evaluates-conversation-select\", function() {\n        $(this).data('previous-value', $(this).val());\n    });\n};\n\n"],"names":["on","select","this","pagequestionid","data","cmid","evaluatesConversationId","parseInt","val","prop","wwwroot","Config","sesskey","M","cfg","ajaxUrl","params","URLSearchParams","action","evaluates_conversation_id","fetch","toString","then","response","json","success","addNotification","message","type","catch","error","exception"],"mappings":";;;;;;;oOA8BoB,yBAEd,QAAQA,GAAG,SAAU,kCAAkC,iBAC/CC,QAAS,mBAAEC,MACXC,eAAiBF,OAAOG,KAAK,kBAC7BC,KAAOJ,OAAOG,KAAK,QACnBE,wBAA0BC,SAASN,OAAOO,MAAO,KAAO,EAG9DP,OAAOQ,KAAK,YAAY,SAElBC,QAAUC,gBAAOD,QACjBE,QAAUD,gBAAOC,SAAWC,EAAEC,IAAIF,QAClCG,QAAUL,QAAU,6BACpBM,OAAS,IAAIC,gBAAgB,CAC/BC,OAAQ,gCACRb,KAAMA,KACNF,eAAgBA,eAChBgB,0BAA2Bb,wBAC3BM,QAASA,UAGbQ,MAAML,QAAU,IAAMC,OAAOK,YACxBC,MAAMC,UAAaA,SAASC,SAC5BF,MAAMC,WACHtB,OAAOQ,KAAK,YAAY,GACpBc,SAASE,8BACIC,gBAAgB,CACzBC,QAASJ,SAASI,SAAW,oCAC7BC,KAAM,aAIV3B,OAAOO,IAAIP,OAAOG,KAAK,mBAAqB,yBAC/BsB,gBAAgB,CACzBC,QAASJ,SAASI,SAAW,2CAC7BC,KAAM,cAIjBC,OAAOC,QACJ7B,OAAOQ,KAAK,YAAY,GAExBR,OAAOO,IAAIP,OAAOG,KAAK,mBAAqB,yBAC/B2B,UAAUD,iCAKjC,QAAQ9B,GAAG,QAAS,kCAAkC,+BAClDE,MAAME,KAAK,kBAAkB,mBAAEF,MAAMM"}