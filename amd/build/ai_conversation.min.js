define("mod_harpiasurvey/ai_conversation",["exports","core/templates","core/notification","core/config","jquery"],(function(_exports,_templates,_notification,_config,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module for AI conversation chat interface.
   *
   * @module     mod_harpiasurvey/ai_conversation
   * @copyright  2025 Your Name
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_config=_interopRequireDefault(_config),_jquery=_interopRequireDefault(_jquery);let initialized=!1;const currentTurns={};_exports.init=()=>{initialized?console.log("ai_conversation: Already initialized"):(console.log("ai_conversation: Initializing..."),(0,_jquery.default)('.ai-conversation-container[data-behavior="turns"]').each((function(){const pageid=parseInt((0,_jquery.default)(this).data("pageid"),10);if(pageid&&!currentTurns[pageid]){const messagesContainer=(0,_jquery.default)("#chat-messages-page-".concat(pageid));let maxTurn=0;messagesContainer.find("[data-turn-id]").each((function(){const turnId=parseInt((0,_jquery.default)(this).data("turn-id"),10);turnId&&turnId>maxTurn&&(maxTurn=turnId)})),currentTurns[pageid]=maxTurn>0?maxTurn:1,setViewingTurn(pageid,currentTurns[pageid]),updateTurnDisplay(pageid),updateChatLockState(pageid),filterMessagesByTurn(pageid,currentTurns[pageid],!1)}})),(0,_jquery.default)(document).on("click",".chat-send-btn",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),cmid=parseInt(button.data("cmid"),10),pageid=parseInt(button.data("pageid"),10);if(!cmid||!pageid)return void _notification.default.addNotification({message:"Missing cmid or pageid",type:"error"});const input=(0,_jquery.default)("#chat-input-page-".concat(pageid));if(0===input.length)return void _notification.default.addNotification({message:"Chat input not found",type:"error"});const inputValue=input.val();if(!inputValue)return;const message=inputValue.trim();if(!message)return;const container=button.closest(".ai-conversation-container");if("turns"===container.data("behavior")){if(getViewingTurn(pageid)!==getCurrentTurn(pageid))return void _notification.default.addNotification({message:"Cannot send messages in a locked turn. Navigate to the current turn first.",type:"error"})}const modelsdata=container.data("models");let modelid=null;if(modelsdata){const modelids=modelsdata.split(",");modelids.length>0&&(modelid=parseInt(modelids[0],10))}if(!modelid)return void _notification.default.addNotification({message:"No model available",type:"error"});input.prop("disabled",!0),button.prop("disabled",!0),input.val("");const tempId="temp-user-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);displayUserMessage(pageid,message,tempId);const loading=(0,_jquery.default)("#chat-loading-page-".concat(pageid));loading.show(),sendMessage(cmid,pageid,message,modelid,button,input,loading)})),(0,_jquery.default)(document).on("keydown",".chat-input",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),(0,_jquery.default)(this).closest(".ai-conversation-container").find(".chat-send-btn").click())})),(0,_jquery.default)(document).on("click",".save-turn-evaluation-questions-btn",(function(e){e.preventDefault(),e.stopPropagation(),console.log("=== Save turn evaluation button clicked! ===");const button=(0,_jquery.default)(this),turnId=parseInt(button.data("turn-id"),10),pageid=parseInt(button.data("pageid"),10),cmid=parseInt(button.data("cmid"),10);if(console.log("Button element:",button[0]),console.log("Button data attributes:",{"data-turn-id":button.attr("data-turn-id"),"data-pageid":button.attr("data-pageid"),"data-cmid":button.attr("data-cmid")}),console.log("Parsed values:",{turnId:turnId,pageid:pageid,cmid:cmid}),!turnId||turnId<1||!pageid||pageid<=0||!cmid||cmid<=0)return console.error("Validation failed:",{turnId:turnId,pageid:pageid,cmid:cmid}),void _notification.default.addNotification({message:"Missing required data (turnId: "+turnId+", pageid: "+pageid+", cmid: "+cmid+")",type:"error"});const evaluationContainer=button.closest(".turn-evaluation-questions"),responses={};evaluationContainer.find("[data-questionid]").each((function(){const questionId=(0,_jquery.default)(this).data("questionid"),questionType=(0,_jquery.default)(this).data("questiontype");let responseValue=null;if("multiplechoice"===questionType){const checked=evaluationContainer.find('input[name="question_'.concat(questionId,'_turn[]"]:checked')),values=[];checked.each((function(){values.push((0,_jquery.default)(this).val())})),responseValue=values.length>0?JSON.stringify(values):null}else if("select"===questionType||"singlechoice"===questionType||"likert"===questionType){const selectSelector='select[name="question_'.concat(questionId,'_turn"]'),inputSelector='input[name="question_'.concat(questionId,'_turn"]:checked'),selected=evaluationContainer.find(selectSelector+", "+inputSelector);responseValue=selected.length>0?selected.val():null}else if("number"===questionType||"shorttext"===questionType){const input=evaluationContainer.find('input[name="question_'.concat(questionId,'_turn"]'));responseValue=input.length>0?input.val():null}else if("longtext"===questionType){const textarea=evaluationContainer.find('textarea[name="question_'.concat(questionId,'_turn"]'));responseValue=textarea.length>0?textarea.val():null}null!==responseValue&&""!==responseValue&&(responses[questionId]=responseValue)})),button.prop("disabled",!0);const originalText=button.text();button.text("Saving..."),saveTurnEvaluationQuestions(cmid,pageid,turnId,responses,button,originalText)})),(0,_jquery.default)(document).on("click",".next-turn-btn",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),pageid=parseInt(button.data("pageid"),10),cmid=parseInt(button.data("cmid"),10);if(!pageid||!cmid)return void _notification.default.addNotification({message:"Missing pageid or cmid",type:"error"});const viewingTurn=getViewingTurn(pageid),currentTurn=getCurrentTurn(pageid);if(viewingTurn<currentTurn)setViewingTurn(pageid,currentTurn),updateTurnDisplay(pageid),updateChatLockState(pageid),filterMessagesByTurn(pageid,currentTurn,!1),ensureTurnEvaluationQuestionsRendered(pageid,currentTurn).then((()=>{loadTurnEvaluationResponses(pageid,currentTurn)}));else{const nextTurn=currentTurn+1;setViewingTurn(pageid,nextTurn),currentTurns[pageid]=nextTurn,updateTurnDisplay(pageid),updateChatLockState(pageid),filterMessagesByTurn(pageid,nextTurn,!1),ensureTurnEvaluationQuestionsRendered(pageid,nextTurn).then((()=>{clearTurnEvaluationForm(pageid,nextTurn)}))}})),(0,_jquery.default)(document).on("click",".prev-turn-btn",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),pageid=parseInt(button.data("pageid"),10);if(!pageid)return void _notification.default.addNotification({message:"Missing pageid",type:"error"});const viewingTurn=getViewingTurn(pageid);if(viewingTurn>1){const prevTurn=viewingTurn-1;setViewingTurn(pageid,prevTurn),updateTurnDisplay(pageid),updateChatLockState(pageid),filterMessagesByTurn(pageid,prevTurn,!1),ensureTurnEvaluationQuestionsRendered(pageid,prevTurn).then((()=>{loadTurnEvaluationResponses(pageid,prevTurn)}))}})),(0,_jquery.default)(document).on("click",".show-previous-messages-btn",(function(e){e.preventDefault();const button=(0,_jquery.default)(this),pageid=parseInt(button.data("pageid"),10),showing=button.data("showing")||!1,viewingTurn=getViewingTurn(pageid);pageid&&filterMessagesByTurn(pageid,viewingTurn,!showing)})),initialized=!0,console.log("ai_conversation: Initialization complete. Event handlers registered."))};const displayUserMessage=function(pageid,message){let messageid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const messagesContainer=(0,_jquery.default)("#chat-messages-page-".concat(pageid)),placeholder=messagesContainer.find(".text-muted.text-center");if(placeholder.length>0&&placeholder.remove(),messageid){if(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)return}const recentMessages=messagesContainer.find(".message").slice(-3);let isDuplicate=!1;if(recentMessages.each((function(){const contentEl=(0,_jquery.default)(this).find(".content");if(0===contentEl.length)return!0;const msgContent=contentEl.text();return msgContent&&msgContent.trim()===message.trim()?(isDuplicate=!0,!1):void 0})),isDuplicate&&!messageid)return;if(messageid){if(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)return}const safeMessage=message&&"string"==typeof message?message:"",container=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container"),behavior=container.data("behavior"),viewingTurn="turns"===behavior?getViewingTurn(pageid):null,templateData={content:safeMessage,id:messageid||"temp-"+Date.now()};viewingTurn&&(templateData.turn_id=viewingTurn),_templates.default.render("mod_harpiasurvey/chat_user_message",templateData).then((html=>{if(messageid){if(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)return}_templates.default.appendNodeContents(messagesContainer[0],html),setTimeout((()=>{scrollToBottom(pageid)}),50)})).catch((()=>{if(messageid){if(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)return}let messageHtml='<div class="message my-3" data-messageid="'+(messageid||"temp-"+Date.now())+'"';viewingTurn&&(messageHtml+=' data-turn-id="'+viewingTurn+'"'),messageHtml+='><div class="d-flex justify-content-end"><div class="border rounded p-2 bg-primary text-white" style="max-width: 80%;"><div class="content">'+message+"</div></div></div></div>",messagesContainer.append(messageHtml),setTimeout((()=>{scrollToBottom(pageid)}),50)}))},sendMessage=(cmid,pageid,message,modelid,button,input,loading)=>{const behavior=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container").data("behavior"),viewingTurn="turns"===behavior?getViewingTurn(pageid):null,params=new URLSearchParams({action:"send_ai_message",cmid:cmid,pageid:pageid,message:message,modelid:modelid,sesskey:_config.default.sesskey});"turns"===behavior&&viewingTurn&&params.append("turn_id",viewingTurn),fetch(_config.default.wwwroot+"/mod/harpiasurvey/ajax.php?"+params.toString(),{method:"GET",headers:{"Content-Type":"application/json"}}).then((response=>{if(!response.ok)throw new Error("HTTP error! status: "+response.status);return response.json()})).then((data=>{if(loading.hide(),data.success){if(data.parentid){const userMessages=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).find(".message").filter((function(){return(0,_jquery.default)(this).find(".bg-primary").length>0}));if(userMessages.length>0){const lastUserMsg=userMessages.last(),currentId=lastUserMsg.attr("data-messageid");currentId&&currentId.startsWith("temp-")&&(lastUserMsg.attr("data-messageid",data.parentid),data.user_message_turn_id&&lastUserMsg.attr("data-turn-id",data.user_message_turn_id))}}if(data.messageid&&data.content){if(function(pageid,content,messageid){let turnId=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const messagesContainer=(0,_jquery.default)("#chat-messages-page-".concat(pageid));if(!messageid)return void console.error("displayAIMessage called without messageid");if(!content)return void console.error("displayAIMessage called without content");if(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)return void console.log("AI message already displayed:",messageid);const templateData={id:messageid,content:content&&"string"==typeof content?content:""};if(turnId){templateData.turn_id=turnId,templateData.pageid=pageid;const container=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container");templateData.cmid=container.data("cmid")}_templates.default.render("mod_harpiasurvey/chat_ai_message",templateData).then((html=>{if(!(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)){if(_templates.default.appendNodeContents(messagesContainer[0],html),turnId){setTimeout((()=>{ensureTurnEvaluationQuestionsRendered(pageid,turnId).then((()=>{loadTurnEvaluationResponses(pageid,turnId)}))}),100);const currentTurn=getCurrentTurn(pageid);turnId>currentTurn&&(currentTurns[pageid]=turnId,updateTurnDisplay(pageid)),getViewingTurn(pageid)===turnId&&filterMessagesByTurn(pageid,turnId,!1)}setTimeout((()=>{scrollToBottom(pageid)}),50)}})).catch((()=>{if(messagesContainer.find('[data-messageid="'.concat(messageid,'"]')).length>0)return;const messageHtml='<div class="message my-3" data-messageid="'+messageid+'"><div class="d-flex"><div class="border rounded p-2 bg-light" style="max-width: 80%;"><div class="content">'+content+"</div></div></div></div>";messagesContainer.append(messageHtml),setTimeout((()=>{scrollToBottom(pageid)}),50)}))}(pageid,data.content,data.messageid,data.turn_id),data.turn_id){const currentTurn=getCurrentTurn(pageid);data.turn_id>currentTurn&&(currentTurns[pageid]=data.turn_id,updateTurnDisplay(pageid),updateChatLockState(pageid))}}else _notification.default.addNotification({message:"Received response but missing message ID or content",type:"error"})}else _notification.default.addNotification({message:data.message||"Error sending message",type:"error"});input.prop("disabled",!1),button.prop("disabled",!1),input.focus()})).catch((error=>{loading.hide(),console.error("Error sending message:",error),_notification.default.addNotification({message:"Error sending message: "+error.message,type:"error"}),input.prop("disabled",!1),button.prop("disabled",!1),input.focus()}))},scrollToBottom=pageid=>{const messagesContainer=(0,_jquery.default)("#chat-messages-page-".concat(pageid));0!==messagesContainer.length&&requestAnimationFrame((()=>{const container=messagesContainer[0];container&&(container.scrollTop=container.scrollHeight)}))},ensureTurnEvaluationQuestionsRendered=(pageid,turnId)=>{const containerWrapper=(0,_jquery.default)("#turn-evaluation-questions-container-".concat(pageid));if(0===containerWrapper.length)return Promise.resolve();const existingContainer=containerWrapper.find('.turn-evaluation-questions[data-turn-id="'.concat(turnId,'"]'));return existingContainer.length>0&&existingContainer.find(".question-item").length>0?Promise.resolve():loadTurnEvaluationQuestions(pageid,turnId)},loadTurnEvaluationQuestions=(pageid,turnId)=>{const container=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container"),questionsDataEl=(0,_jquery.default)("#turn-evaluation-questions-data-".concat(pageid));if(0===questionsDataEl.length)return Promise.resolve();try{const questionsForTurn=JSON.parse(questionsDataEl.text()).filter((q=>(q.min_turn||1)<=turnId));if(0===questionsForTurn.length)return Promise.resolve();const containerWrapper=(0,_jquery.default)("#turn-evaluation-questions-container-".concat(pageid));if(0===containerWrapper.length)return Promise.resolve();let evaluationContainer=containerWrapper.find('.turn-evaluation-questions[data-turn-id="'.concat(turnId,'"]'));if(0===evaluationContainer.length){const containerHtml='<div class="turn-evaluation-questions mt-3 pt-3 border-top" data-turn-id="'.concat(turnId,'" data-pageid="').concat(pageid,'" data-cmid="').concat(cmid,'"></div>');containerWrapper.append(containerHtml),evaluationContainer=containerWrapper.find('.turn-evaluation-questions[data-turn-id="'.concat(turnId,'"]'))}const cmid=container.data("cmid");return console.log("Rendering turn evaluation questions:",{pageid:pageid,turnId:turnId,cmid:cmid,questionsCount:questionsForTurn.length}),_templates.default.render("mod_harpiasurvey/turn_evaluation_questions",{questions:questionsForTurn,has_questions:questionsForTurn.length>0,turn_id:turnId,pageid:pageid,cmid:cmid}).then((html=>{evaluationContainer.html(html),console.log("Turn evaluation questions rendered. HTML length:",html.length);const button=evaluationContainer.find(".save-turn-evaluation-questions-btn");return console.log("Save button found after render:",button.length,"Button data:",{turnId:button.data("turn-id"),pageid:button.data("pageid"),cmid:button.data("cmid")}),Promise.resolve()})).catch((error=>(console.error("Error rendering turn evaluation questions:",error),Promise.reject(error))))}catch(error){console.error("Error parsing turn evaluation questions data:",error)}},saveTurnEvaluationQuestions=(cmid,pageid,turnId,responses,button,originalText)=>{if(!turnId||turnId<1)return _notification.default.addNotification({message:"Invalid turn ID",type:"error"}),button.prop("disabled",!1),void button.text(originalText);const savePromises=Object.keys(responses).map((questionId=>{const params=new URLSearchParams({action:"save_response",cmid:cmid,pageid:pageid,questionid:questionId,response:responses[questionId],turn_id:turnId.toString(),sesskey:_config.default.sesskey}),url=_config.default.wwwroot+"/mod/harpiasurvey/ajax.php?"+params.toString();return console.log("Saving turn evaluation response:",{questionId:questionId,turnId:turnId,url:url}),fetch(url,{method:"GET",headers:{"Content-Type":"application/json"}}).then((response=>response.json())).then((data=>(console.log("Response from save:",data),data)))}));Promise.all(savePromises).then((results=>{if(results.every((r=>r.success))){const evaluationContainer=(0,_jquery.default)("#turn-evaluation-questions-container-".concat(pageid)).find('.turn-evaluation-questions[data-turn-id="'.concat(turnId,'"]')),now=Math.floor(Date.now()/1e3);Object.keys(responses).forEach((questionId=>{showTurnEvaluationTimestamp(evaluationContainer,questionId,now)}))}else _notification.default.addNotification({message:"Some responses could not be saved",type:"error"});button.prop("disabled",!1),button.text(originalText)})).catch((error=>{console.error("Error saving turn evaluation questions:",error),_notification.default.addNotification({message:"Error saving responses: "+error.message,type:"error"}),button.prop("disabled",!1),button.text(originalText)}))},loadTurnEvaluationResponses=(pageid,turnId)=>{const cmid=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container").data("cmid"),evaluationContainer=(0,_jquery.default)("#turn-evaluation-questions-container-".concat(pageid)).find('.turn-evaluation-questions[data-turn-id="'.concat(turnId,'"]'));if(0===evaluationContainer.length)return;const params=new URLSearchParams({action:"get_turn_responses",cmid:cmid,pageid:pageid,turn_id:turnId,sesskey:_config.default.sesskey});fetch(_config.default.wwwroot+"/mod/harpiasurvey/ajax.php?"+params.toString(),{method:"GET",headers:{"Content-Type":"application/json"}}).then((response=>response.json())).then((data=>{data.success&&data.responses&&Object.keys(data.responses).length>0?Object.keys(data.responses).forEach((questionId=>{const responseData=data.responses[questionId],responseValue="object"==typeof responseData?responseData.response:responseData,timestamp="object"==typeof responseData?responseData.timemodified:null,questionType=evaluationContainer.find('[data-questionid="'.concat(questionId,'"]')).data("questiontype");if("multiplechoice"===questionType)try{const values=JSON.parse(responseValue);Array.isArray(values)&&values.forEach((val=>{const selector='input[name="question_'.concat(questionId,'_turn[]"][value="').concat(val,'"]');evaluationContainer.find(selector).prop("checked",!0)}))}catch(e){}else if("select"===questionType)evaluationContainer.find('select[name="question_'.concat(questionId,'_turn"]')).val(responseValue);else if("singlechoice"===questionType||"likert"===questionType){const selector='input[name="question_'.concat(questionId,'_turn"][value="').concat(responseValue,'"]');evaluationContainer.find(selector).prop("checked",!0)}else"number"===questionType||"shorttext"===questionType?evaluationContainer.find('input[name="question_'.concat(questionId,'_turn"]')).val(responseValue):"longtext"===questionType&&evaluationContainer.find('textarea[name="question_'.concat(questionId,'_turn"]')).val(responseValue);timestamp?showTurnEvaluationTimestamp(evaluationContainer,questionId,timestamp):hideTurnEvaluationTimestamp(evaluationContainer,questionId)})):(clearTurnEvaluationForm(pageid,turnId),evaluationContainer.find(".turn-evaluation-saved-message").remove())})).catch((error=>{console.error("Error loading turn evaluation responses:",error)}))},clearTurnEvaluationForm=(pageid,turnId)=>{const evaluationContainer=(0,_jquery.default)("#turn-evaluation-questions-container-".concat(pageid)).find('.turn-evaluation-questions[data-turn-id="'.concat(turnId,'"]'));0!==evaluationContainer.length&&(evaluationContainer.find('input[type="radio"]').prop("checked",!1),evaluationContainer.find('input[type="checkbox"]').prop("checked",!1),evaluationContainer.find("select").val(""),evaluationContainer.find('input[type="text"], input[type="number"]').val(""),evaluationContainer.find("textarea").val(""),evaluationContainer.find(".turn-evaluation-saved-message").remove())},showTurnEvaluationTimestamp=(evaluationContainer,questionId,timestamp)=>{hideTurnEvaluationTimestamp(evaluationContainer,questionId);const questionItem=evaluationContainer.find('[data-questionid="'.concat(questionId,'"]'));if(0===questionItem.length)return;const datetimeStr=new Date(1e3*timestamp).toLocaleString(),messageHtml='<div class="mt-2 small text-muted turn-evaluation-saved-message" '+'data-questionid="'.concat(questionId,'">')+'<i class="fa fa-check-circle" aria-hidden="true"></i> '+"Saved on ".concat(datetimeStr,"</div>");questionItem.append(messageHtml)},hideTurnEvaluationTimestamp=(evaluationContainer,questionId)=>{evaluationContainer.find('.turn-evaluation-saved-message[data-questionid="'.concat(questionId,'"]')).remove()},getCurrentTurn=pageid=>currentTurns[pageid]||1,getViewingTurn=pageid=>{const container=(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container");return parseInt(container.data("viewing-turn")||getCurrentTurn(pageid),10)},setViewingTurn=(pageid,turn)=>{(0,_jquery.default)("#chat-messages-page-".concat(pageid)).closest(".ai-conversation-container").data("viewing-turn",turn)},updateTurnDisplay=pageid=>{const viewingTurn=getViewingTurn(pageid),currentTurn=getCurrentTurn(pageid);(0,_jquery.default)("#current-turn-number-".concat(pageid)).text(viewingTurn);const prevBtn=(0,_jquery.default)('.prev-turn-btn[data-pageid="'.concat(pageid,'"]'));viewingTurn>1?prevBtn.show():prevBtn.hide();const nextBtn=(0,_jquery.default)('.next-turn-btn[data-pageid="'.concat(pageid,'"]'));viewingTurn<currentTurn?nextBtn.html('Go to current turn <i class="fa fa-chevron-right"></i>'):nextBtn.html('Create next turn <i class="fa fa-chevron-right"></i>')},updateChatLockState=pageid=>{const viewingTurn=getViewingTurn(pageid),currentTurn=getCurrentTurn(pageid),input=(0,_jquery.default)("#chat-input-page-".concat(pageid)),sendBtn=(0,_jquery.default)('.chat-send-btn[data-pageid="'.concat(pageid,'"]')),lockMessage=(0,_jquery.default)("#turn-locked-message-".concat(pageid));viewingTurn<currentTurn?(input.prop("disabled",!0),sendBtn.prop("disabled",!0),lockMessage.length>0&&lockMessage.show()):(input.prop("disabled",!1),sendBtn.prop("disabled",!1),lockMessage.length>0&&lockMessage.hide())},filterMessagesByTurn=function(pageid,turnId){let showPrevious=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const messagesContainer=(0,_jquery.default)("#chat-messages-page-".concat(pageid)),toggleContainer=(0,_jquery.default)("#previous-messages-toggle-".concat(pageid));let hasPreviousMessages=!1;if(messagesContainer.find(".message").each((function(){const messageTurnId=(0,_jquery.default)(this).data("turn-id");if(messageTurnId){const msgTurn=parseInt(messageTurnId,10);msgTurn===turnId?((0,_jquery.default)(this).show(),(0,_jquery.default)(this).removeClass("previous-turn-message")):msgTurn<turnId?(hasPreviousMessages=!0,showPrevious?((0,_jquery.default)(this).show(),(0,_jquery.default)(this).addClass("previous-turn-message")):((0,_jquery.default)(this).hide(),(0,_jquery.default)(this).addClass("previous-turn-message"))):((0,_jquery.default)(this).hide(),(0,_jquery.default)(this).removeClass("previous-turn-message"))}else(0,_jquery.default)(this).show(),(0,_jquery.default)(this).removeClass("previous-turn-message")})),hasPreviousMessages&&turnId>1){toggleContainer.show();const toggleBtn=toggleContainer.find(".show-previous-messages-btn");showPrevious?(toggleBtn.html('<i class="fa fa-chevron-up"></i> Hide previous messages'),toggleBtn.data("showing",!0)):(toggleBtn.html('<i class="fa fa-chevron-down"></i> Show previous messages'),toggleBtn.data("showing",!1))}else toggleContainer.hide();setTimeout((()=>{scrollToBottom(pageid)}),50)}}));

//# sourceMappingURL=ai_conversation.min.js.map