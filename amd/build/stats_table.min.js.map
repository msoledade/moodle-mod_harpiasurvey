{"version":3,"file":"stats_table.min.js","sources":["../src/stats_table.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Stats table functionality for expanding/collapsing long answers.\n *\n * @module     mod_harpiasurvey/stats_table\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n    'use strict';\n\n    /**\n     * Render answer items as HTML tags.\n     *\n     * @param {Array} answerItems Array of answer item objects\n     * @return {string} HTML string\n     */\n    function renderAnswerItems(answerItems) {\n        let html = '';\n        answerItems.forEach(function(item) {\n            if (item.isoption) {\n                html += '<span class=\"badge badge-secondary answer-tag mr-1 mb-1\">';\n                html += '<span class=\"answer-text\">' + $('<div>').text(item.text).html() + '</span>';\n                html += '</span>';\n            } else {\n                html += '<span class=\"answer-text-plain\">' + $('<div>').text(item.text).html() + '</span>';\n            }\n        });\n        return html;\n    }\n\n    /**\n     * Initialize stats table functionality.\n     */\n    function init() {\n        // Handle expand/collapse for conversations.\n        $(document).on('click', '.expand-conversation-btn', function() {\n            const button = $(this);\n            const conversationId = button.data('conversation-id');\n            const messagesDiv = $('.conversation-messages[data-conversation-id=\"' + conversationId + '\"]');\n            const expandText = button.find('.expand-text');\n            const collapseText = button.find('.collapse-text');\n\n            if (messagesDiv.is(':visible')) {\n                // Collapse\n                messagesDiv.slideUp();\n                expandText.show();\n                collapseText.hide();\n            } else {\n                // Expand\n                messagesDiv.slideDown();\n                expandText.hide();\n                collapseText.show();\n            }\n        });\n\n        // Handle expand/collapse button clicks for answers.\n        $(document).on('click', '.expand-answer-btn', function() {\n            const button = $(this);\n            const responseId = button.data('response-id');\n            const answerContainer = $('.answer-container[data-response-id=\"' + responseId + '\"]');\n            const answerItemsDiv = answerContainer.find('.answer-items');\n            const expandText = button.find('.expand-text');\n            const collapseText = button.find('.collapse-text');\n            const answerItemsJson = answerContainer.data('answer-items');\n\n            if (!answerItemsJson) {\n                return;\n            }\n\n            let answerItems;\n            try {\n                answerItems = JSON.parse(answerItemsJson);\n            } catch (e) {\n                // eslint-disable-next-line no-console\n                console.error('Error parsing answer items:', e);\n                return;\n            }\n\n            if (answerContainer.data('expanded')) {\n                // Collapse - show truncated version (first item only if multiple, or truncated text).\n                let displayItems = [];\n                let totalLength = 0;\n                for (let i = 0; i < answerItems.length; i++) {\n                    const item = answerItems[i];\n                    const itemText = item.text || '';\n                    if (totalLength + itemText.length > 100 && i > 0) {\n                        break;\n                    }\n                    if (itemText.length > 100) {\n                        // Truncate this item.\n                        displayItems.push({\n                            text: itemText.substring(0, 100) + '...',\n                            number: item.number,\n                            isoption: item.isoption\n                        });\n                        break;\n                    } else {\n                        displayItems.push(item);\n                        totalLength += itemText.length;\n                    }\n                }\n                answerItemsDiv.html(renderAnswerItems(displayItems));\n                answerContainer.data('expanded', false);\n                expandText.show();\n                collapseText.hide();\n            } else {\n                // Expand - show all answer items.\n                answerItemsDiv.html(renderAnswerItems(answerItems));\n                answerContainer.data('expanded', true);\n                expandText.hide();\n                collapseText.show();\n            }\n        });\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","renderAnswerItems","answerItems","html","forEach","item","isoption","text","init","document","on","button","this","conversationId","data","messagesDiv","expandText","find","collapseText","is","slideUp","show","hide","slideDown","responseId","answerContainer","answerItemsDiv","answerItemsJson","JSON","parse","e","console","error","displayItems","totalLength","i","length","itemText","push","substring","number"],"mappings":";;;;;;;AAuBAA,sCAAO,CAAC,WAAW,SAASC,YASfC,kBAAkBC,iBACnBC,KAAO,UACXD,YAAYE,SAAQ,SAASC,MACrBA,KAAKC,UACLH,MAAQ,4DACRA,MAAQ,6BAA+BH,EAAE,SAASO,KAAKF,KAAKE,MAAMJ,OAAS,UAC3EA,MAAQ,WAERA,MAAQ,mCAAqCH,EAAE,SAASO,KAAKF,KAAKE,MAAMJ,OAAS,aAGlFA,WAwFJ,CACHK,gBAjFAR,EAAES,UAAUC,GAAG,QAAS,4BAA4B,iBAC1CC,OAASX,EAAEY,MACXC,eAAiBF,OAAOG,KAAK,mBAC7BC,YAAcf,EAAE,gDAAkDa,eAAiB,MACnFG,WAAaL,OAAOM,KAAK,gBACzBC,aAAeP,OAAOM,KAAK,kBAE7BF,YAAYI,GAAG,aAEfJ,YAAYK,UACZJ,WAAWK,OACXH,aAAaI,SAGbP,YAAYQ,YACZP,WAAWM,OACXJ,aAAaG,WAKrBrB,EAAES,UAAUC,GAAG,QAAS,sBAAsB,iBACpCC,OAASX,EAAEY,MACXY,WAAab,OAAOG,KAAK,eACzBW,gBAAkBzB,EAAE,uCAAyCwB,WAAa,MAC1EE,eAAiBD,gBAAgBR,KAAK,iBACtCD,WAAaL,OAAOM,KAAK,gBACzBC,aAAeP,OAAOM,KAAK,kBAC3BU,gBAAkBF,gBAAgBX,KAAK,oBAExCa,2BAIDzB,gBAEAA,YAAc0B,KAAKC,MAAMF,iBAC3B,MAAOG,eAELC,QAAQC,MAAM,8BAA+BF,MAI7CL,gBAAgBX,KAAK,YAAa,KAE9BmB,aAAe,GACfC,YAAc,MACb,IAAIC,EAAI,EAAGA,EAAIjC,YAAYkC,OAAQD,IAAK,OACnC9B,KAAOH,YAAYiC,GACnBE,SAAWhC,KAAKE,MAAQ,MAC1B2B,YAAcG,SAASD,OAAS,KAAOD,EAAI,WAG3CE,SAASD,OAAS,IAAK,CAEvBH,aAAaK,KAAK,CACd/B,KAAM8B,SAASE,UAAU,EAAG,KAAO,MACnCC,OAAQnC,KAAKmC,OACblC,SAAUD,KAAKC,iBAInB2B,aAAaK,KAAKjC,MAClB6B,aAAeG,SAASD,OAGhCV,eAAevB,KAAKF,kBAAkBgC,eACtCR,gBAAgBX,KAAK,YAAY,GACjCE,WAAWK,OACXH,aAAaI,YAGbI,eAAevB,KAAKF,kBAAkBC,cACtCuB,gBAAgBX,KAAK,YAAY,GACjCE,WAAWM,OACXJ,aAAaG"}